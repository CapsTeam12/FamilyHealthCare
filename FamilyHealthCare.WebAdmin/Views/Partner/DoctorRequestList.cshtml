@model IEnumerable<Contract.DTOs.PartnerService.DoctorRequestDetailsDto>
@using Contract.DTOs.PartnerService;
@using FamilyHealthCare.SharedLibrary;
@{
    ViewData["Title"] = "Doctor Request List";
    ViewData["breadcumb-title"] = "Doctor";
    ViewData["CurrentMenu"] = "active";
    int count = 0;
}
<link href="~/css/Awards.css" rel="stylesheet" />
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@("@")fancyapps/ui/dist/fancybox.css" />
<style>
    a[data-fancybox] img {
        cursor: zoom-in;
    }

    .modal{
        z-index:1040;
    }

    .modal-backdrop{
        z-index:1030;
    }
</style>
<div class="row">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="partnerList" class="datatable table table-hover table-center mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Speciality</th>
                                <th class="text-center">Status</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var doctorReq in Model)
                            {
                                count++;
                                <tr>
                                    <td>
                                        <h2 class="table-avatar">
                                            <a asp-controller="Doctor" asp-action="DetailsDoctor" class="avatar avatar-sm me-2"><img class="avatar-img rounded-circle" src=@(ImageConstants.DOCTORS+doctorReq.Avatar) alt="User Image"></a>
                                            <a id="detail@(count)" class="btnDetails" href="#personal_details" data-bs-toggle="modal">Dr. @doctorReq.FullName</a>
                                        </h2>
                                    </td>
                                    <td hidden>@doctorReq.Phone</td>
                                    <td>@doctorReq.Email</td>
                                    <td hidden>@doctorReq.DateOfBirth.ToShortDateString()</td>
                                    <td hidden>@doctorReq.Gender</td>
                                    <td hidden>@doctorReq.Address</td>
                                    <td hidden>@doctorReq.Biography</td>
                                    <td hidden>@(ImageConstants.CERTIFICATION_DOCTORS+doctorReq.Certifications)</td>
                                    <td>@doctorReq.Specialized</td>
                                    <td hidden>@doctorReq.Experiences.Count</td>
                                    @foreach (var ex in doctorReq.Experiences)
                                    {
                                        <td hidden>@ex.HospitalName</td>
                                        <td hidden>@ex.From - @ex.To</td>
                                    }
                                    <td class="text-center">
                                        <span class="badge rounded-pill bg-warning-light">Pending</span>
                                    </td>
                                    <td class="text-end">
                                        <div class="actions">
                                            <a id="accept@(count)" data-id="@doctorReq.Id" data-bs-toggle="modal" href="#accept_modal" class="btn btn-sm bg-success-light me-2 btnAccept">
                                                <i class="fe fe-check"></i> Accept
                                            </a>
                                            <a id="delete@(count)" data-id="@doctorReq.Id" class="btn btn-sm bg-danger-light btnDeny" data-bs-toggle="modal" href="#delete_modal">
                                                <i class="fe fe-trash"></i> Delete
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Accept Form-->
<div class="modal fade" id="accept_modal">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <!--	<div class="modal-header">
                    <h5 class="modal-title">Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>-->
            <input type="hidden" value="" id="doctorId" />
            <div class="modal-body">
                <div class="form-content p-2">
                    <h4 id="test" class="modal-title">Accept</h4>
                    <p class="mb-4">Are you sure want to accept?</p>
                    <button id="btnSend" type="button" class="btn btn-primary"> Accept </button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Modal Accept Form-->
<!-- Details Modal -->
<div class="modal fade" id="personal_details" aria-hidden="true" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Personal Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row form-row">
                    <div class="col-12">
                        <h5 class="form-title"><span>Avatar</span></h5>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <div class="avatar avatar-xl">
                                <img id="image" style="margin: 5px 200px 5px 200px;"
                                     class="avatar-img rounded-circle" alt="User Image" src="">
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <h5 class="form-title"><span>Information</span></h5>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input id="fullName" type="text" class="form-control" value="" readonly>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <label>Phone</label>
                            <input id="phone" type="text" value="" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <label>Email</label>
                            <input id="email" type="text" class="form-control" value="" readonly>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <label>Gender</label>
                            <input id="gender" type="text" class="form-control" value="" readonly>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <label>DateOfBirth</label>
                            <input id="dob" type="email" class="form-control" value="" readonly>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label>Address</label>
                            <input id="address" type="text" class="form-control" value="" readonly>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label>Biography</label>
                            <textarea id="biography" type="text" class="form-control" value="" readonly>
                                </textarea>
                        </div>
                    </div>
                    <div class="col-12">
                        <h5 class="form-title"><span>Certification</span></h5>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="form-group">
                            <div class="avatar avatar-xl">
                                <a id="certificationBox" data-fancybox="gallery" href="">
                                    <img id="certification" style="margin: 5px 200px 5px 200px;width:100%;"
                                         class="avatar-img rounded" alt="User Image" src="" />
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <h5 class="form-title"><span>Specialize</span></h5>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label class="btn btn-outline-info rounded" id="specialize">Specialize</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <h5 class="form-title"><span>Experiences</span></h5>
                    </div>
                    <!-- Experience Details -->
                    <div class="widget experience-widget">
                        <h4 class="widget-title">Work & Experience</h4>
                        <div class="experience-box">
                            <ul class="experience-list">
                            </ul>
                        </div>
                    </div>
                    <!-- /Experience Details -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Details Modal -->
<!-- Modal Deny Form-->
<div class="modal fade" id="delete_modal" aria-hidden="true" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <!--	<div class="modal-header">
                <h5 class="modal-title">Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>-->
            <input type="hidden" value="" id="doctorId2" />
            <div class="modal-body">
                <div class="form-content p-2">
                    <h4 class="modal-title">Delete</h4>
                    <p class="mb-4">Are you sure want to delete?</p>
                    <button id="btnDelete" type="button" class="btn btn-primary"> Delete </button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Modal Deny Form-->


@section scripts{
    <script src="https://cdn.jsdelivr.net/npm/@("@")fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
    <script>
        $(document).ready(function () {
            $('body').on('click', '.btnAccept', function () {
                var id = $(this).attr('id');
                $('#accept_modal').data('id', id);
                $('#doctorId').val($(this).data('id'));
            });

            $('body').on('click', '#btnSend', function () {
                var doctorId = $('#doctorId').val();
                $.ajax({
                    url: '/Partner/AcceptDoctorRequest',
                    type: 'GET',
                    data: { doctorId: Number(doctorId) },
                    success: function (res) {
                        if (res.success == true) {
                            var id = $('#accept_modal').data('id');
                            $('#' + id).parents("tr").remove();
                            $('#accept_modal').modal('hide');
                        }
                    }
                });
            })

            $('body').on('click', '.btnDeny', function () {
                var id = $(this).attr('id');
                $('#delete_modal').data('id', id);
                $('#doctorId2').val($(this).data('id'));
            });

            $('body').on('click', '#btnDelete', function () {
                var doctorId = $('#doctorId2').val();
                $.ajax({
                    url: '/Partner/DenyDoctorRequest',
                    type: 'GET',
                    data: { doctorId: Number(doctorId) },
                    success: function (res) {
                        if (res.success == true) {
                            var id = $('#delete_modal').data('id');
                            $('#' + id).parents("tr").remove();
                            $('#delete_modal').modal('hide');
                        }
                    }
                });
            })

            $('body').on('click', '.btnDetails', function () {
                var id = $(this).attr('id');
                $('#personal_details').data('id', id);
                var modalId = $('#personal_details').data('id');
                var tdElements = $('#' + modalId).parents("tr").children();
                let image = tdElements[0].getElementsByTagName('img');
                $('#image').attr('src', image[0].getAttribute('src'));
                $('#fullName').val(tdElements[0].innerText);
                $('#phone').val(tdElements[1].innerText);
                $('#email').val(tdElements[2].innerText);
                $('#dob').val(tdElements[3].innerText);
                if (tdElements[4].innerText == '1') {
                    $('#gender').val('Male');
                } else {
                    $('#gender').val('Female');
                }
                $('#address').val(tdElements[5].innerText);
                $('#biography').val(tdElements[6].innerText);
                $('#certificationBox').attr('href', tdElements[7].innerText);
                $('#certification').attr('src', tdElements[7].innerText);
                $('#specialize').text(tdElements[8].innerText);
                var experiencesLength = tdElements[9].innerText
                //console.log(experiencesLength);
                var currentNum = (tdElements.length - experiencesLength) - 2; // (Tổng phần tử <td> - tổng số lượng awards) - 1
                //console.log(currentNum);
                var lengthExperiencesList = $('.experience-list').children().length;
                if (lengthExperiencesList < experiencesLength) {
                    for (var i = experiencesLength; i >= 1; i--) {
                        var listExperiences = '<li>' +
                            '<div class="experience-user">' +
                            '<div class="before-circle"></div>' +
                            '</div>' +
                            '<div class="experience-content">' +
                            '<div class="timeline-content">' +
                            '<a id="hospital" href="#/" class="name">' + tdElements[currentNum - i].innerText + '</a>' +
                            '<span id="year" class="time">' + tdElements[(currentNum + 1) - i].innerText + '</span>' +
                            '</div>' +
                            '</div>' +
                            '</li>';
                        $('.experience-list').append(listExperiences);
                        currentNum++;
                    }
                }                
            });

            Fancybox.bind('[data-fancybox="gallery"]', {                
                Image: {
                    zoom: false,
                },
            });
        })
    </script>
}
@using FamilyHealthCare.SharedLibrary;
@model MedicalRecordViewModel
@{
    int count = 0;
    ViewData["breadcrumb-title"] = "Medical Records";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
<style>
    .ui-autocomplete {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1510 !important;
        float: left;
        display: none;
        min-width: 160px;
        width: 160px;
        padding: 4px 0;
        margin: 2px 0 0 0;
        list-style: none;
        background-color: #ffffff;
        border-color: #ccc;
        border-color: rgba(0, 0, 0, 0.2);
        border-style: solid;
        border-width: 1px;
        -webkit-border-radius: 2px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        -webkit-background-clip: padding-box;
        -moz-background-clip: padding;
        background-clip: padding-box;
        *border-right-width: 2px;
        *border-bottom-width: 2px;
    }
</style>
<div class="col-md-7 col-lg-8 col-xl-9">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-body pt-0">

                    <!-- Tab Menu -->
                    <!-- /Tab Menu -->
                    <!-- Tab Content -->
                    <div class="tab-content pt-0">

                        <!-- Medical Records Tab -->
                        <div id="pat_medicalrecords" class="tab-pane fade show active">
                            <div class="text-end">
                                <a href="#" class="add-new-btn" data-bs-toggle="modal" data-bs-target="#add_medical_records_modal">Add Medical Records</a>
                            </div>
                            <div class="card card-table mb-0">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="medicalTable" class="table table-hover table-center mb-0">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Name</th>
                                                    <th>Date</th>
                                                    <th>Symptoms</th>
                                                    <th>Created By</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.MedicalRecords != null && Model.MedicalRecords.Count() > 0)
                                                {
                                                    foreach (var medicalRecord in Model.MedicalRecords)
                                                    {
                                                        count++;
                                                        <tr>
                                                            <td>@count</td>
                                                            <td><a href="patient-profile.html"><span>@medicalRecord.Patient.FullName</span></a></td>
                                                            <td>@medicalRecord.Date</td>
                                                            <td><a href="medical-records-detail.html"><span>@medicalRecord.Symptom</span></a></td>
                                                            <td>Dr. @medicalRecord.Doctor.FullName</td>
                                                            <td>
                                                                <a asp-area="" asp-controller="MedicalRecords" asp-action="MedicalRecordDetails" class="btn btn-sm bg-info-light">
                                                                    <i class="far fa-eye"></i> View
                                                                </a>
                                                                <a href="#" class="btn btn-sm bg-success-light" data-bs-toggle="modal" data-bs-target="#Edit_medical_records_modal">
                                                                    <i class="far fa-edit"></i> Edit
                                                                </a>
                                                                <a class="btn btn-sm bg-danger-light" data-bs-toggle="modal" href="#delete_modal">
                                                                    <i class="fas fa-trash-alt"></i> Delete
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {

                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /Medical Records Tab -->


                    </div>
                    <!-- Tab Content -->

                </div>
            </div>
        </div>
    </div>
</div>
<h5 hidden id="count">@count</h5>
<!-- Medical Records Modal -->
<div class="modal fade custom-modal custom-medicalrecord-modal" id="add_medical_records_modal" style="display: none;" data-select2-id="add_medical_records_modal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Medical Records</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <form id="AddMedicalRecordForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Patient Name</label>
                                <select name="PatientId" class="form-select">
                                    @if (Model.Patients != null && Model.Patients.Count() > 0)
                                    {
                                        foreach (var patient in Model.Patients)
                                        {
                                            <option value="@patient.Id">@patient.FullName - @patient.Id</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Symptoms</label>
                                <input type="text" name="Symptom" class="form-control" placeholder="Symptom">
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="rows">
                            <div class="form-group">
                                <label>Diagnosis</label>
                                <input type="text" class="input-tags form-control" value="" name="Diagnosis" placeholder="Diagnosis">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="rows">
                            <div class="form-group">
                                <label>Advice</label>
                                <textarea name="Advice" rows="2" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Examination Date</label>
                                <input type="hidden" name="DoctorId" value="@Model.doctorDetails.Id" />
                                <input type="date" class="form-control" name="Date">
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <div class="form-group">
                                    <label>Re-Examination</label>
                                    <input type="date" class="form-control" name="ReExamination">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <div class="submit-section text-center">
                            <button type="button" id="medical_btn" class="btn btn-primary submit-btn">Submit</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- /Medical Records Modal -->
<div class="modal fade custom-modal custom-medicalrecord-modal" id="Edit_medical_records_modal" style="display: none;" data-select2-id="add_medical_records_modal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Medical Records</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <form id="medical_records_form" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Patient Name</label>
                                <input type="text" name="description" class="form-control" placeholder="Enter Patient Name">
                            </div>
                        </div>

                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Age</label>
                                <input type="text" name="description" class="form-control" placeholder="Age">
                            </div>
                        </div>

                    </div>


                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <label>Symptoms</label>
                                <input type="text" data-role="tagsinput" class="input-tags form-control" value="Fever, Fatigue" name="services" id="services">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Doctor</label>
                                <select class="form-select">
                                    <option>Steplen</option>
                                    <option>Richard</option>
                                    <option>Self</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label>Date</label>
                                <div class="form-group">
                                    <input type="date" class="form-control" name="tratment_date" id="tratment_date">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <div class="submit-section text-center">
                            <button type="submit" id="medical_btn" class="btn btn-primary submit-btn">Submit</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- /Medical Records Modal -->
<div class="modal fade" id="delete_modal" aria-hidden="true" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

            <div class="modal-body">
                <div class="form-content p-2">
                    <h4 class="modal-title">Delete</h4>
                    <p class="mb-4">Are you sure want to delete ?</p>
                    <button type="button" class="btn btn-primary">Save </button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function () {
            $('body').on('click', '.submit-btn', function () {
                var form = $('#AddMedicalRecordForm').serialize();
                console.log(form);
                $.ajax({
                    url: '/MedicalRecords/CreateMedicalRecord',
                    type: 'POST',
                    data: form,
                    success: function (res) {
                        if (res.success) {
                            $('#add_medical_records_modal').modal('hide');
                            var medical = res.item;
                            var count = Number($('#count').text()) + 1;
                            $('#count').text(count);
                            //console.log(count);
                            var element = $('<tr></tr>');
                            element.append('<td>' + count + '</td>');
                            element.append('<td><a href="patient-profile.html"><span>' + medical.patient.fullName + '</span></a></td>');
                            element.append('<td>' + medical.date + '</td>');
                            element.append('<td><a href="medical-records-detail.html"><span>' + medical.symptom + '</span></a></td>');
                            element.append('<td>Dr. ' + medical.doctor.fullName + '</td>');
                            var lastTdElement = '<td>' +
                                '<a asp-area="" asp-controller="MedicalRecords" asp-action="MedicalRecordDetails" class="btn btn-sm bg-info-light"><i class="far fa-eye"></i> View</a>' +
                                '<a href="#" class="btn btn-sm bg-success-light" data-bs-toggle="modal" data-bs-target="#Edit_medical_records_modal"><i class="far fa-edit"></i> Edit</a>' +
                                '<a class="btn btn-sm bg-danger-light" data-bs-toggle="modal" href="#delete_modal"><i class="fas fa-trash-alt"></i> Delete</a>' +
                                '</td>';
                            element.append(lastTdElement);
                            element.appendTo('#medicalTable tbody');
                            $('#AddMedicalRecordForm form')[0].reset();
                        }
                    }
                });
            })
        })
    </script>
}